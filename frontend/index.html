<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Travel & Culture Shopping Assistant</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #4285f4;
        --primary-dark: #3367d6;
        --secondary: #34a853;
        --warning: #fbbc04;
        --danger: #ea4335;

        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --bg-tertiary: #e8f0fe;
        --bg-overlay: rgba(255, 255, 255, 0.95);

        --text-primary: #202124;
        --text-secondary: #5f6368;
        --text-tertiary: #80868b;

        --border-primary: #dadce0;
        --border-secondary: #e8eaed;
        --border-focus: #4285f4;

        --shadow-sm: 0 1px 3px rgba(60, 64, 67, 0.3);
        --shadow-md: 0 4px 6px rgba(60, 64, 67, 0.15);
        --shadow-lg: 0 8px 25px rgba(60, 64, 67, 0.15);
        --shadow-xl: 0 25px 50px rgba(60, 64, 67, 0.25);

        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --radius-full: 9999px;

        --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      [data-theme="dark"] {
        --bg-primary: #1f1f1f;
        --bg-secondary: #2d2d30;
        --bg-tertiary: #2d3748;
        --bg-overlay: rgba(31, 31, 31, 0.95);

        --text-primary: #e8eaed;
        --text-secondary: #9aa0a6;
        --text-tertiary: #80868b;

        --border-primary: #3c4043;
        --border-secondary: #5f6368;

        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.5);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.3);
        --shadow-xl: 0 25px 50px rgba(0, 0, 0, 0.5);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        overflow: hidden;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg-secondary);
        color: var(--text-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        transition: var(--transition);
      }

      .container {
        width: 100%;
        max-width: 1000px;
        height: 95vh;
        background: var(--bg-primary);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        display: flex;
        flex-direction: column;
        border: 1px solid var(--border-primary);
        transition: var(--transition);
        animation: containerSlideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
      }

      @keyframes containerSlideUp {
        from {
          opacity: 0;
          transform: translateY(40px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .header {
        background: var(--bg-primary);
        padding: 24px 32px 16px 32px;
        border-bottom: 1px solid var(--border-primary);
        position: relative;
        transition: var(--transition);
        flex-shrink: 0;
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
      }

      .header-title {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .header-title h1 {
        font-size: 24px;
        font-weight: 600;
        color: var(--text-primary);
        letter-spacing: -0.5px;
      }

      .header-title i {
        font-size: 24px;
        color: var(--primary);
      }

      .header-controls {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .theme-toggle {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-full);
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-secondary);
        font-size: 16px;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .theme-toggle:hover {
        background: var(--bg-tertiary);
        color: var(--primary);
        transform: scale(1.05);
        box-shadow: var(--shadow-sm);
      }

      .theme-toggle:active {
        transform: scale(0.95);
      }

      .theme-toggle::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at center,
          var(--primary) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .theme-toggle:hover::before {
        opacity: 0.05;
      }

      .header-subtitle {
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 400;
        line-height: 1.5;
      }

      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--bg-secondary);
        position: relative;
        transition: var(--transition);
        min-height: 0;
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 24px 32px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        scroll-behavior: smooth;
        overscroll-behavior: contain;
      }

      .chat-messages::-webkit-scrollbar {
        width: 8px;
      }

      .chat-messages::-webkit-scrollbar-track {
        background: var(--bg-secondary);
        border-radius: 4px;
      }

      .chat-messages::-webkit-scrollbar-thumb {
        background: var(--border-secondary);
        border-radius: 4px;
        border: 1px solid var(--bg-secondary);
      }

      .chat-messages::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
      }

      .chat-messages::-webkit-scrollbar-corner {
        background: var(--bg-secondary);
      }

      .welcome-message {
        text-align: center;
        padding: 60px 20px;
        animation: welcomeFadeIn 0.8s ease-out 0.2s both;
      }

      @keyframes welcomeFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .welcome-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        border-radius: var(--radius-xl);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        margin: 0 auto 24px;
        box-shadow: var(--shadow-lg);
        animation: welcomeIconPulse 2s ease-in-out infinite;
      }

      @keyframes welcomeIconPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .welcome-message h2 {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--text-primary);
        letter-spacing: -0.5px;
      }

      .welcome-message p {
        font-size: 16px;
        line-height: 1.6;
        color: var(--text-secondary);
        max-width: 500px;
        margin: 0 auto;
      }

      .example-queries {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 12px;
        margin-top: 32px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .example-query {
        background: var(--bg-primary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-md);
        padding: 16px 20px;
        font-size: 14px;
        cursor: pointer;
        transition: var(--transition);
        color: var(--text-primary);
        text-align: left;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        animation: exampleQuerySlide 0.6s ease-out both;
        animation-delay: calc(var(--index, 0) * 0.1s);
      }

      @keyframes exampleQuerySlide {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .example-query::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .example-query:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        color: white;
      }

      .example-query:hover::before {
        opacity: 1;
      }

      .example-query span {
        position: relative;
        z-index: 1;
      }

      .message {
        display: flex;
        gap: 16px;
        animation: messageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        flex-shrink: 0;
      }

      @keyframes messageSlideIn {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .message.user {
        flex-direction: row-reverse;
      }

      .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-full);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        flex-shrink: 0;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
      }

      .message.user .message-avatar {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
      }

      .message.bot .message-avatar {
        background: linear-gradient(135deg, var(--secondary), #2d7d32);
        color: white;
      }

      .message-avatar:hover {
        transform: scale(1.1);
      }

      .message-content {
        flex: 1;
        max-width: 75%;
        min-width: 0;
      }

      .message-bubble {
        padding: 16px 20px;
        border-radius: var(--radius-lg);
        font-size: 15px;
        line-height: 1.6;
        word-wrap: break-word;
        transition: var(--transition);
        overflow-wrap: break-word;
      }

      .message.user .message-bubble {
        background: var(--primary);
        color: white;
        border-bottom-right-radius: var(--radius-sm);
        box-shadow: var(--shadow-sm);
      }

      .message.bot .message-bubble {
        background: var(--bg-primary);
        color: var(--text-primary);
        border: 1px solid var(--border-primary);
        border-bottom-left-radius: var(--radius-sm);
        box-shadow: var(--shadow-sm);
      }

      .message-time {
        font-size: 12px;
        color: var(--text-tertiary);
        margin-top: 8px;
        text-align: right;
        opacity: 0.8;
      }

      .message.user .message-time {
        text-align: left;
      }

      .product-recommendation {
        margin-top: 16px;
        padding: 20px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--primary);
        transition: var(--transition);
      }

      .product-item {
        display: flex;
        gap: 16px;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-primary);
        transition: var(--transition);
      }

      .product-item:last-child {
        border-bottom: none;
      }

      .product-item:hover {
        background: var(--bg-primary);
        margin: 0 -8px;
        padding: 12px 8px;
        border-radius: var(--radius-sm);
      }

      .product-image {
        width: 60px;
        height: 60px;
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-tertiary);
        border: 1px solid var(--border-primary);
      }

      .product-details {
        flex: 1;
      }

      .product-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
      }

      .product-price {
        color: var(--primary);
        font-weight: 600;
      }

      .input-container {
        padding: 20px 32px 24px 32px;
        background: var(--bg-primary);
        border-top: 1px solid var(--border-primary);
        transition: var(--transition);
        flex-shrink: 0;
      }

      .input-wrapper {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        background: var(--bg-secondary);
        border-radius: var(--radius-full);
        padding: 4px 4px 4px 20px;
        border: 2px solid var(--border-primary);
        transition: var(--transition);
        position: relative;
      }

      .input-wrapper::before {
        content: "";
        position: absolute;
        inset: -2px;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        border-radius: var(--radius-full);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: -1;
      }

      .input-wrapper:focus-within {
        border-color: transparent;
        background: var(--bg-primary);
        box-shadow: var(--shadow-md);
      }

      .input-wrapper:focus-within::before {
        opacity: 1;
      }

      .chat-input {
        flex: 1;
        border: none;
        background: transparent;
        font-size: 16px;
        padding: 16px 0;
        outline: none;
        resize: none;
        max-height: 120px;
        min-height: 20px;
        color: var(--text-primary);
        font-family: inherit;
      }

      .chat-input::placeholder {
        color: var(--text-tertiary);
      }

      .send-button {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        border: none;
        border-radius: var(--radius-full);
        width: 44px;
        height: 44px;
        color: white;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        flex-shrink: 0;
        box-shadow: var(--shadow-sm);
        position: relative;
        overflow: hidden;
      }

      .send-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at center,
          rgba(255, 255, 255, 0.3) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .send-button:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: var(--shadow-md);
      }

      .send-button:hover:not(:disabled)::before {
        opacity: 1;
      }

      .send-button:active:not(:disabled) {
        transform: scale(0.95);
      }

      .send-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .typing-indicator {
        display: flex;
        gap: 16px;
        animation: messageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        flex-shrink: 0;
      }

      .typing-dots {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 16px 20px;
        background: var(--bg-primary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-lg);
        border-bottom-left-radius: var(--radius-sm);
        box-shadow: var(--shadow-sm);
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: var(--radius-full);
        background: var(--text-tertiary);
        animation: typingDot 1.4s infinite ease-in-out;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingDot {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.4;
        }
        30% {
          transform: translateY(-8px);
          opacity: 1;
        }
      }

      .error-message {
        background: rgba(234, 67, 53, 0.1);
        border: 1px solid rgba(234, 67, 53, 0.2);
        color: var(--danger);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-top: 8px;
        font-size: 14px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        body {
          padding: 0;
        }

        .container {
          height: 100vh;
          border-radius: 0;
          max-width: 100%;
        }

        .header {
          padding: 16px 20px 12px 20px;
        }

        .header-title h1 {
          font-size: 20px;
        }

        .chat-messages {
          padding: 20px 16px;
        }

        .input-container {
          padding: 16px 20px 20px 20px;
        }

        .message-content {
          max-width: 85%;
        }

        .example-queries {
          grid-template-columns: 1fr;
          gap: 8px;
        }

        .welcome-message {
          padding: 40px 20px;
        }

        .welcome-message h2 {
          font-size: 24px;
        }
      }

      /* Focus styles for accessibility */
      .theme-toggle:focus-visible,
      .example-query:focus-visible,
      .send-button:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }

      .chat-input:focus {
        outline: none;
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        :root {
          --border-primary: #000;
          --border-secondary: #333;
        }
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Scroll indicator */
      .scroll-indicator {
        position: absolute;
        bottom: 100px;
        right: 20px;
        background: var(--primary);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: var(--radius-full);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: var(--shadow-md);
        transition: var(--transition);
        z-index: 10;
        opacity: 0;
        transform: scale(0.8);
        pointer-events: none;
      }

      .scroll-indicator.visible {
        opacity: 1;
        transform: scale(1);
        pointer-events: all;
      }

      .scroll-indicator:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header-content">
          <div class="header-title">
            <i class="fas fa-globe-americas"></i>
            <h1>Travel Assistant</h1>
          </div>
          <div class="header-controls">
            <button
              class="theme-toggle"
              id="themeToggle"
              aria-label="Toggle dark mode"
            >
              <i class="fas fa-sun" id="themeIcon"></i>
            </button>
          </div>
        </div>
        <p class="header-subtitle">
          AI-powered travel shopping recommendations with cultural insights
        </p>
      </div>

      <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
          <div class="welcome-message">
            <div class="welcome-icon">
              <i class="fas fa-suitcase-rolling"></i>
            </div>
            <h2>Welcome to your Travel Assistant!</h2>
            <p>
              Get personalized travel shopping recommendations, packing advice,
              and culturally appropriate gift suggestions for your destinations.
            </p>

            <div class="example-queries">
              <div
                class="example-query"
                onclick="sendExampleQuery(this.querySelector('span').textContent)"
                style="--index: 0"
              >
                <span>I'm visiting Turkey in October, what should I pack?</span>
              </div>
              <div
                class="example-query"
                onclick="sendExampleQuery(this.querySelector('span').textContent)"
                style="--index: 1"
              >
                <span>Show me trending gifts for Eid in Dubai</span>
              </div>
              <div
                class="example-query"
                onclick="sendExampleQuery(this.querySelector('span').textContent)"
                style="--index: 2"
              >
                <span>What clothes should I bring to Japan in winter?</span>
              </div>
              <div
                class="example-query"
                onclick="sendExampleQuery(this.querySelector('span').textContent)"
                style="--index: 3"
              >
                <span>Cultural gifts for Wedding celebration in Pakistan</span>
              </div>
            </div>
          </div>
        </div>

        <div
          class="scroll-indicator"
          id="scrollIndicator"
          onclick="scrollToBottom()"
          title="Scroll to bottom"
        >
          <i class="fas fa-chevron-down"></i>
        </div>

        <div class="input-container">
          <div class="input-wrapper">
            <textarea
              class="chat-input"
              id="chatInput"
              placeholder="Ask me about travel shopping recommendations..."
              rows="1"
            ></textarea>
            <button
              class="send-button"
              id="sendButton"
              onclick="sendMessage()"
              aria-label="Send message"
            >
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      //const API_BASE_URL = "http://localhost:5000";

      const chatMessages = document.getElementById("chatMessages");
      const chatInput = document.getElementById("chatInput");
      const sendButton = document.getElementById("sendButton");
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const scrollIndicator = document.getElementById("scrollIndicator");

      // Theme Management
      function initTheme() {
        const savedTheme = localStorage.getItem("theme") || "light";
        document.documentElement.setAttribute("data-theme", savedTheme);
        updateThemeIcon(savedTheme);
      }

      function toggleTheme() {
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";

        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
        updateThemeIcon(newTheme);

        // Add a subtle animation to the toggle button
        themeToggle.style.transform = "scale(0.9)";
        setTimeout(() => {
          themeToggle.style.transform = "scale(1)";
        }, 100);
      }

      function updateThemeIcon(theme) {
        themeIcon.className = theme === "dark" ? "fas fa-moon" : "fas fa-sun";
      }

      themeToggle.addEventListener("click", toggleTheme);

      // Scroll Management
      function scrollToBottom(smooth = true) {
        chatMessages.scrollTo({
          top: chatMessages.scrollHeight,
          behavior: smooth ? "smooth" : "auto",
        });
      }

      function updateScrollIndicator() {
        const { scrollTop, scrollHeight, clientHeight } = chatMessages;
        const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;

        if (scrollPercentage < 0.95 && scrollHeight > clientHeight) {
          scrollIndicator.classList.add("visible");
        } else {
          scrollIndicator.classList.remove("visible");
        }
      }

      chatMessages.addEventListener("scroll", updateScrollIndicator);

      // Auto-resize textarea
      chatInput.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = Math.min(this.scrollHeight, 120) + "px";
      });

      // Send message on Enter (but allow Shift+Enter for new lines)
      chatInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      function sendExampleQuery(query) {
        chatInput.value = query;
        sendMessage();
      }

      function getCurrentTime() {
        return new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // Ensure scroll to bottom after adding new content
      function addMessage(content, isUser = false, isError = false) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${isUser ? "user" : "bot"}`;

        const avatar = document.createElement("div");
        avatar.className = "message-avatar";
        avatar.innerHTML = isUser
          ? '<i class="fas fa-user"></i>'
          : '<i class="fas fa-robot"></i>';

        const contentDiv = document.createElement("div");
        contentDiv.className = "message-content";

        const bubble = document.createElement("div");
        bubble.className = "message-bubble";

        if (isError) {
          bubble.innerHTML = `<div class="error-message">${content}</div>`;
        } else if (typeof content === "object" && content.products) {
          let html = `<p>${content.explanation || content.message}</p>`;
          if (content.products && content.products.length > 0) {
            html += '<div class="product-recommendation">';
            html +=
              '<h4><i class="fas fa-shopping-bag"></i> Recommended Products:</h4>';
            content.products.forEach((product) => {
              html += `
                            <div class="product-item">
                                <div class="product-image">
                                    <i class="fas fa-tshirt"></i>
                                </div>
                                <div class="product-details">
                                    <div class="product-name">${
                                      product.name || "Product"
                                    }</div>
                                    <div class="product-price">$${
                                      product.price || "N/A"
                                    }</div>
                                </div>
                            </div>
                        `;
            });
            html += "</div>";
          }
          bubble.innerHTML = html;
        } else {
          bubble.textContent = content;
        }

        const timeDiv = document.createElement("div");
        timeDiv.className = "message-time";
        timeDiv.textContent = getCurrentTime();

        contentDiv.appendChild(bubble);
        contentDiv.appendChild(timeDiv);
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(contentDiv);

        const welcomeMessage = chatMessages.querySelector(".welcome-message");
        if (welcomeMessage) {
          welcomeMessage.remove();
        }

        chatMessages.appendChild(messageDiv);
        scrollToBottom(); // Ensure scroll to bottom after adding message
      }

      function showTypingIndicator() {
        const typingDiv = document.createElement("div");
        typingDiv.className = "typing-indicator";
        typingDiv.id = "typingIndicator";

        const avatar = document.createElement("div");
        avatar.className = "message-avatar";
        avatar.innerHTML = '<i class="fas fa-robot"></i>';

        const dotsDiv = document.createElement("div");
        dotsDiv.className = "typing-dots";
        dotsDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;

        typingDiv.appendChild(avatar);
        typingDiv.appendChild(dotsDiv);
        chatMessages.appendChild(typingDiv);
        scrollToBottom(); // Ensure scroll to bottom during typing
      }

      function hideTypingIndicator() {
        const typingIndicator = document.getElementById("typingIndicator");
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      function getCurrentTime() {
        return new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      async function sendMessage() {
        const message = chatInput.value.trim();
        if (!message || sendButton.disabled) return;

        addMessage(message, true);
        chatInput.value = "";
        chatInput.style.height = "auto";

        sendButton.disabled = true;
        showTypingIndicator();

        try {
          const response = await fetch(`/chat`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: message,
            }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          hideTypingIndicator();

          if (data.error) {
            addMessage(data.error, false, true);
          } else {
            addMessage(data);
          }
        } catch (error) {
          hideTypingIndicator();
          console.error("Error:", error);
          addMessage(
            `Sorry, I'm having trouble connecting to the server. Please try again later.`,
            false,
            true
          );
        } finally {
          sendButton.disabled = false;
          chatInput.focus();
        }
      }

      window.addEventListener("load", () => {
        chatInput.focus();
      });
    </script>
  </body>
</html>
